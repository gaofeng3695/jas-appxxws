<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport"
        content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="../css/fonts/font-awesome.min.css">
        <link rel="stylesheet" href="../css/ui-box.css">
        <link rel="stylesheet" href="../css/ui-base.css">
        <link rel="stylesheet" href="../css/ui-color.css">
        <link rel="stylesheet" href="../css/appcan.icon.css">
        <link rel="stylesheet" href="../css/appcan.control.css">
        <link rel="stylesheet" href="css/personal.css">
    </head>
    <body class="um-vp bc-bg " ontouchstart>
        <div class="ub ub-ver ">
            <div class="header">
                <div class="mar5 linhm">
                    <div class=" ub" id="edit">
                        <div class="editimg ">
                            <img src="images/nantou.png" id="profile">
                        </div>
                        <div class="marl25  ub-f1  ">
                            <div class=" sc-border-fff padd25 texc  ">
                                <div class="userName clrfff ulev26 linh" >
                                    <!-- 谁谁谁水水水水所 -->
                                </div>
                                <div class="ub-f1 parorgname clrfff ulev26 ulim100 linh">
                                    <!-- 试试事实上是是是是是是是 -->
                                </div>
                                <div class="ub">
                                    <div class="ub-f1 enterprise clrfff ulev26 ulim100 linh ">
                                        <!-- 试试事实上是是是是是是是试试事实上是是是是是是 -->
                                    </div>
                                    <div class="width50  status">

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <!-- <div class="ub padd linh">
                <div class="textleft clrfff ulev26 ulim100 enterprise">
                测试
                </div>
                <div class="width50 marr30 status">

                </div>
                </div>  -->
            </div>

        </div>
        <div class="umar-tcon contenttop us1">
            <div class="list ub ub-ac  uinn-lrlist ubb bc-border uinn-3 sc-border-cor hidden"  id="managerenter">
                <div class="ub-f1 ut-s ">
                    <img src="images/icon_qy.png" class="imgsrc">
                    <span>企业管理</span>
                </div>
                <div class="ulev-1 t-6b9 u-2">
                    <img src="images/direction.png" class="directionsize">
                </div>
            </div>
            <div class="list ub ub-ac  uinn-lrlist ubb bc-border uinn-3 sc-border-cor hidden"  id="share">

                <div class="ub-f1 ut-s ">
                    <img src="images/icon_yq1.png" class="imgsrc">
                    <span>邀请同事</span>
                </div>
                <div class="ulev-1 t-6b9 u-2">
                    <img src="images/direction.png" class="directionsize">
                </div>
            </div>
            <div class="list ub ub-ac  uinn-lrlist ubb bc-border uinn-3 sc-border-cor" id="myenter">

                <div class="ub-f1 ut-s ">
                    <img src="images/icon_wdqy.png" class="imgsrc">
                    <span>我的企业</span>
                </div>
                <div class="ulev-1 t-6b9 u-2">
                    <img src="images/direction.png" class="directionsize">
                </div>
            </div>
        </div>

        <div class="umar-tcon contenttop us1">
            <div class="list ub ub-ac  uinn-lrlist ubb bc-border uinn-3 sc-border-cor" id="commonproblem">
                <div class="ub-f1 ut-s ">
                    <img src="images/async.png" class="imgsrc">
                    <span>使用帮助</span>
                </div>
                <div class="ulev-1 t-6b9 u-2">
                    <img src="images/direction.png" class="directionsize">
                </div>
            </div>
            <div class="list ub ub-ac  uinn-lrlist ubb bc-border uinn-3 sc-border-cor" id="idea">

                <div class="ub-f1 ut-s ">
                    <img src="images/icon_fk.png" class="imgsrc">
                    <span>意见反馈</span>
                </div>
                <div class="ulev-1 t-6b9 u-2">
                    <img src="images/direction.png" class="directionsize">
                </div>
            </div>
        </div>

        <div class="umar-tcon contenttop us1">
            <div class="list ub ub-ac  uinn-lrlist ubb bc-border uinn-3 sc-border-cor" id="updateversion">
                <div class="ub-f1 ut-s ub-ac" >
                    <img src="images/updateversion.png" class="imgsrc" />
                    <span>版本更新</span>
                    <div class="version-new" style="display:none">
                        New
                    </div>
                </div>
                <div class="ulev-1 t-6b9 u-2 ub-ac direction">
                    <div class="version"></div>
                    <div class="direction_img">
                        <img src="images/direction.png" class="directionsize" />
                    </div>
                </div>
            </div>
            <div class="list ub ub-ac  uinn-lrlist ubb bc-border uinn-3 sc-border-cor" id="aboutus">
                <div class="ub-f1 ut-s ">
                    <img src="images/aboutus1.png" class="imgsrc">
                    <span>关于我们</span>
                </div>
                <div class="ulev-1 t-6b9 u-2">
                    <img src="images/direction.png" class="directionsize">
                </div>
            </div>
        </div>
        <div class="ub ub-ver loginout">
            <div class="btn ub ub-ac bc-text-head ub-pc bc-btn uc-a1" id="quite">
                退出登录
            </div>
        </div>
        </div>

        <script src="../js/appcan.js"></script>
        <script src="../js/appcan.control.js"></script>
        <script src="../js/appcan.listview.js"></script>
        <script src="../common/js/common_device.js"></script>
           <script src="../common/js/common_base.js"></script>
        <script src="../common/js/common_httprequest.js"></script>
        <script src="../common/js/common_userprofile.js"></script>
    </body>
    <script>
        appcan.ready(function() {
            userObj.init();
        });
        var userObj = {
            jasHttpRequest : new JasHttpRequest(),
            _userBo : JSON.parse(appcan.locStorage.getVal("userBo")),
            init : function() {
                this.bindEvent();
                this.initLoad();
            },
            initLoad : function() {
                var that = this;
                JasDevice.getConnectStatus(function(params) {
                    if (params == -1) {
                        that.renderuser(that._userBo);
                    } else {
                        that.getLastUserBo();
                    }
                });
            },
            getLastUserBo : function() {
                var that = this;
                var old_userBo = JSON.parse(appcan.locStorage.getVal("userBo"));
                var partURL1 = "cloudlink-core-framework/user/getById?objectId=" + old_userBo.objectId + "&enterpriseId=" + old_userBo.enterpriseId;
                that.jasHttpRequest.jasHttpGet(partURL1, function(id, state, dbSource) {
                    if (dbSource == "") {
                        that.renderuser(old_userBo);
                        that.judgeUserAdmin(old_userBo);
                        return;
                    }
                    var dbList = JSON.parse(dbSource);
                    if (dbList.success == 1 && dbList.rows.length > 0) {
                        that.renderuser(dbList.rows[0]);
                        appcan.locStorage.setVal("userBo", dbList.rows[0]);
                        that.judgeUserAdmin(dbList.rows[0]);
                    } else {
                        that.judgeUserAdmin(old_userBo);
                    }
                });
            },
            renderuser : function(userBo) {
                $(".userName").html(userBo.userName);
                if (userBo.parentOrgName) {
                    $(".parorgname").html(userBo.parentOrgName + ">" + userBo.orgName);
                } else {
                    $(".parorgname").html(userBo.orgName);
                }
                // $(".orgname").html();
                $(".enterprise").html(userBo.enterpriseName);
                if (userBo.authenticateStatus == 1) {
                    $(".status").css('background', 'url(images/certified.png) no-repeat center');
                    $(".status").css('backgroundSize', '2.875em 1.375em');
                }
                var _path = getUserProfilePath();
                if (_path != "") {
                    document.getElementById("profile").src = _path;
                } else {
                    if (userBo.sex == "女") {
                        document.getElementById("profile").src = "images/girl.png";
                    }
                }
                this.getAppVersionFromServer();
            },
            getAppVersionFromServer : function() {
                var that = this;
                try {
                    var partURL1 = "cloudlink-core-framework/appversion/getActiveVersion?productId=pipeline-bodyguard&clientType=Android";
                    that.jasHttpRequest.jasHttpGet(partURL1, function(id, state, dbSource) {
                        if (dbSource == "") {
                            return;
                        }
                        var obj = JSON.parse(dbSource);
                        if (obj.success == 1) {
                            if (obj.rows.length > 0) {
                                /*
                                 *服务端信息
                                 */
                                var appServer_Version = obj.rows[0].versionNumber;
                                var appServer_appVersion = obj.rows[0].appcanVersion;
                                /*
                                 * 客户端信息
                                 */
                                uexWidgetOne.getCurrentWidgetInfo();
                                uexWidgetOne.cbGetCurrentWidgetInfo = function(opId, dataType, data) {
                                    var appClient = eval('(' + data + ')');
                                    var appCliehtVersion = appClient.version;
                                    if (that.isExistNewVersion(appCliehtVersion, appServer_appVersion)) {
                                        $(".version").text("发现新版本 " + appServer_Version);
                                        $(".version-new").show();
                                    } else {
                                        $(".version").text("已经是最新版本  " + appCliehtVersion);
                                        $(".version-new").hide();
                                    }
                                }
                            }
                        } else {
                            uexWidgetOne.getCurrentWidgetInfo();
                            uexWidgetOne.cbGetCurrentWidgetInfo = function(opId, dataType, data) {
                                var appClient = eval('(' + data + ')');
                                var appCliehtVersion = appClient.version;
                                $(".version").text("已经是最新版本 " + appCliehtVersion);
                                $(".version-new").hide();
                            }
                        }
                    });
                } catch(e) {
                    uexWidgetOne.getCurrentWidgetInfo();
                    uexWidgetOne.cbGetCurrentWidgetInfo = function(opId, dataType, data) {
                        var appClient = eval('(' + data + ')');
                        var appCliehtVersion = appClient.version;
                        $(".version").text("已经是最新版本 " + appCliehtVersion);
                        $(".version-new").hide();
                    }
                }
            },
            // //判断是否新版本
            isExistNewVersion : function(_clientVersion, _serverVersion) {
                try {
                    var _client = _clientVersion.replace(/\./g, "");
                    var _server = _serverVersion.replace(/\./g, "");

                    if (parseInt(_server) > parseInt(_client)) {
                        return true;
                    }
                    return false;
                } catch(e) {
                    return false;
                }
            },
            judgeUserAdmin : function(_userBo) {
                if (_userBo.isSysadmin == 1) {
                    $("#managerenter").removeClass("hidden");
                    $("#share").removeClass("hidden");
                } else {
                    $("#managerenter").addClass("hidden");
                    $("#share").addClass("hidden");
                }

            },
            isSharePeople : function() {
                var that=this;
                var partURL1 = "cloudlink-core-framework/invite/breachUserCountLimit?enterpriseId="+that._userBo.enterpriseId;
                that.jasHttpRequest.jasHttpGet(partURL1, function(id, state, data) {
                    if (data == "") {
                        baseOperation.alertToast("网关异常：稍候尝试");
                        return;
                    }
                    if (JSON.parse(data).success == 1) {
                        if(JSON.parse(data).rows[0].breachLimit){
                            baseOperation.alertToast("已经达到上限，不可再次邀请");
                        }else{
                           appcan.openWinWithUrl("share_content1", "share_content1.html");
                        }
                    }
                });

            },
            bindEvent : function() {
                var that = this;
                appcan.button("#commonproblem", "btn-act", function() {
                    appcan.openWinWithUrl("help_center", "../help_center/help.html");
                });
                appcan.button("#update", "btn-act", function() {
                    document.getElementById("hiddendiv").style.display = 'block';
                    document.getElementById("showdiv").style.display = 'none';
                });
                /*邀请注册*/
                appcan.button("#share", "btn-act", function() {
                    that.isSharePeople();
                });
                /*意见反馈*/
                appcan.button("#idea", "btn-act", function() {
                    appcan.openWinWithUrl("suggestions", "../setting/personcenter_v1.3/suggestions.html");
                });
                //点击进行个人信息的修改操作
                appcan.button("#edit", "btn-act", function() {
                    appcan.openWinWithUrl("updateadmininformation", "updateadmininformation.html");
                });
                /*点击企业管理页面*/
                appcan.button("#managerenter", "btn-act", function() {
                    appcan.openWinWithUrl("manager", "../setting/personcenter_v1.3/manager.html");
                });
                /*我的企业*/
                appcan.button("#myenter", "btn-act", function() {
                    appcan.openWinWithUrl("myenter", "../setting/myEnteprise/myenter.html");
                });
                /*版本的更新*/
                appcan.button("#updateversion", "btn-act", function() {
                    appcan.openWinWithUrl("versionupdate", "version_update.html");
                });
                /*关于我们*/
                appcan.button("#aboutus", "btn-act", function() {
                    appcan.openWinWithUrl("aboutus", "../personal/aboutus.html");
                });

                appcan.button("#quite", "btn-act", function() {
                    try {
                        if (uexLockScreen.checkServerIsRunning() == 1) {
                            alert("尊敬的用户：\r\n您当前正处于巡检状态中，无法直接退出，请先结束本次巡检。");
                        } else {

                            uexTianji.flush()

                            appcan.locStorage.remove("token");
                            appcan.locStorage.remove("userBo");
                            appcan.locStorage.remove("enterpriseName");
                            appcan.locStorage.remove("pipeLinesData");
                            //移除企业名称
                            //施飞 2016-11-10 清除UserBo的localstroge事件
                            appcan.openWinWithUrl("login", "../login.html");
                            appcan.window.evaluateScript("personal", "closeWin()");
                        }
                    } catch(e) {
                        uexTianji.flush()
                        appcan.locStorage.remove("token");
                        appcan.locStorage.remove("userBo");
                        appcan.locStorage.remove("enterpriseName");
                        //移除企业名称
                        //施飞 2016-11-10 清除UserBo的localstroge事件
                        appcan.openWinWithUrl("login", "../login.html");
                        appcan.window.evaluateScript("personal", "closeWin()");
                    }

                });
            }
        }

    </script>
</html>
